# CrewAIäººç‹¼ã‚²ãƒ¼ãƒ  - 10äººæ‘
import os
import random
import datetime
from crewai import Agent, Task, Crew, LLM

# --------------------------------------------------------------------
# 1. LLMï¼ˆå¤§è¦æ¨¡è¨€èªãƒ¢ãƒ‡ãƒ«ï¼‰ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
# --------------------------------------------------------------------
def setup_llm():
    """Gemini LLMã‚’åˆæœŸåŒ–ï¼ˆCrewAI 0.134.0ç‰ˆï¼‰"""
    try:
        api_key = os.environ.get("GOOGLE_API_KEY")
        if not api_key:
            raise ValueError("GOOGLE_API_KEYç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“")
        
        llm = LLM(
            model="gemini/gemini-2.5-flash",
            api_key=api_key,
            temperature=0.8  # äººç‹¼ã‚²ãƒ¼ãƒ ã¯å‰µé€ æ€§ãŒé‡è¦ãªã®ã§é«˜ã‚ã«è¨­å®š
        )
        print("âœ… LLMåˆæœŸåŒ–æˆåŠŸ")
        return llm
    except Exception as e:
        print(f"âŒ LLMåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: {e}")
        exit(1)

# --------------------------------------------------------------------
# 2. ãƒ­ã‚°ç®¡ç†ã‚¯ãƒ©ã‚¹
# --------------------------------------------------------------------
class WerewolfLogger:
    def __init__(self):
        # warewolf_logs ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆï¼ˆæ—¢å­˜ã§ã‚‚ã‚¨ãƒ©ãƒ¼ãªã—ï¼‰
        os.makedirs("warewolf_logs", exist_ok=True)
        
        # ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã§ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ç”Ÿæˆï¼ˆæœ€æ–°é †ã§ä¸¦ã¶ï¼‰
        timestamp = datetime.datetime.now()
        timestamp_str = timestamp.strftime("%Y%m%d%H%M%S")
        self.log_file = f"warewolf_logs/open_mode_{timestamp_str}.md"
        
        # ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆæœŸåŒ–
        with open(self.log_file, 'w', encoding='utf-8') as f:
            f.write(f"ğŸº CrewAIäººç‹¼ã‚²ãƒ¼ãƒ  ãƒ­ã‚° - {timestamp.strftime('%Y-%m-%d %H:%M:%S')}\n")
            f.write("=" * 80 + "\n\n")
        
        print(f"ğŸ“ ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ: {self.log_file}")
    
    def log_and_print(self, message):
        """ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è¡¨ç¤ºã—ã€ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚‚è¨˜éŒ²"""
        print(message)
        with open(self.log_file, 'a', encoding='utf-8') as f:
            f.write(message + "\n")
    
    def log_phase(self, phase_name, day_num=None):
        """ãƒ•ã‚§ãƒ¼ã‚ºã®é–‹å§‹ã‚’ãƒ­ã‚°"""
        if day_num:
            msg = f"\n{'='*60}\n{phase_name} - {day_num}æ—¥ç›®\n{'='*60}"
        else:
            msg = f"\n{'='*60}\n{phase_name}\n{'='*60}"
        self.log_and_print(msg)
    
    def log_result(self, result, title=""):
        """CrewAIã®å®Ÿè¡Œçµæœã‚’ãƒ­ã‚°"""
        self.log_and_print(f"\n--- {title} ---")
        self.log_and_print(str(result))

# --------------------------------------------------------------------
# 3. ã‚²ãƒ¼ãƒ çŠ¶æ…‹ç®¡ç†ã‚¯ãƒ©ã‚¹
# --------------------------------------------------------------------
class WerewolfGameState:
    def __init__(self):
        self.day_count = 0
        self.phase = "night"  # "day" or "night"
        self.alive_players = []
        self.dead_players = []
        self.votes = {}
        self.night_actions = {}
        self.game_over = False
        self.winner = None
        
        # å½¹è·åˆ¥ãƒªã‚¹ãƒˆ
        self.werewolves = ['werewolf1', 'werewolf2']
        self.madman = 'madman'
        self.fortune_teller = 'fortune_teller'
        self.knight = 'knight'
        self.citizens = ['citizen1', 'citizen2', 'citizen3', 'citizen4']
        
        # å ã„ãƒ»è­·è¡›çµæœ
        self.fortune_results = []
        self.protected_player = None

# --------------------------------------------------------------------
# 3. å„å½¹è·ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä½œæˆ
# --------------------------------------------------------------------
def create_werewolf_agents(llm):
    """äººç‹¼ã‚²ãƒ¼ãƒ ã®å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ä½œæˆ"""
    
    # ã‚²ãƒ¼ãƒ ãƒã‚¹ã‚¿ãƒ¼
    game_master = Agent(
        role='ã‚²ãƒ¼ãƒ ãƒã‚¹ã‚¿ãƒ¼',
        goal='å…¬æ­£ã§ç™½ç†±ã—ãŸäººç‹¼ã‚²ãƒ¼ãƒ ã‚’é€²è¡Œã—ã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŸã¡ã®æ¨ç†ã¨é§†ã‘å¼•ãã‚’æœ€å¤§é™ã«å¼•ãå‡ºã™',
        backstory="""ã‚ãªãŸã¯æ•°ç™¾å›ã®äººç‹¼ã‚²ãƒ¼ãƒ ã‚’é€²è¡Œã—ã¦ããŸãƒ™ãƒ†ãƒ©ãƒ³ã‚²ãƒ¼ãƒ ãƒã‚¹ã‚¿ãƒ¼ã§ã™ã€‚
        ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å¿ƒç†ã‚’èª­ã¿ã€é©åˆ‡ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§æƒ…å ±ã‚’é–‹ç¤ºã—ã€ã‚²ãƒ¼ãƒ ã‚’ç››ã‚Šä¸Šã’ã‚‹ã“ã¨ã«é•·ã‘ã¦ã„ã¾ã™ã€‚
        ä¸­ç«‹çš„ãªç«‹å ´ã‚’ä¿ã¡ãªãŒã‚‰ã€å…¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒæ¥½ã—ã‚ã‚‹ã‚ˆã†é…æ…®ã—ã¾ã™ã€‚
        
        â˜…é‡è¦â˜… å¿…ãšæ—¥æœ¬èªã®ã¿ã§ç™ºè¨€ã—ã¦ãã ã•ã„ã€‚è‹±èªã‚„ä»–ã®è¨€èªã¯ä¸€åˆ‡ä½¿ç”¨ç¦æ­¢ã§ã™ã€‚""",
        verbose=True,
        allow_delegation=False,
        llm=llm
    )
    
    # äººç‹¼1ï¼ˆãƒªãƒ¼ãƒ€ãƒ¼ã‚¿ã‚¤ãƒ—ï¼‰
    werewolf1 = Agent(
        role='äººç‹¼ï¼ˆã‚¢ãƒ«ãƒ•ã‚¡ï¼‰',
        goal='ä»²é–“ã®äººç‹¼ã¨é€£æºã—ã€å¸‚æ°‘ã‚’é¨™ã—ã¦äººç‹¼é™£å–¶ã®å‹åˆ©ã‚’ç›®æŒ‡ã™',
        backstory="""ã‚ãªãŸã¯å†·é™æ²ˆç€ã§æˆ¦ç•¥çš„æ€è€ƒã«å„ªã‚ŒãŸäººç‹¼ã§ã™ã€‚äººç‹¼æ­´3å¹´ã®ãƒ™ãƒ†ãƒ©ãƒ³ã§ã€
        ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã‚’ç™ºæ®ã—ã¦ä»²é–“ã‚’å°ãã¾ã™ã€‚è«–ç†çš„ãªæ¨ç†ã§å¸‚æ°‘ã‚’è£…ã„ã€
        å·§å¦™ãªèª˜å°ã§æ‘äººåŒå£«ã‚’ç–‘å¿ƒæš—é¬¼ã«é™¥ã‚Œã‚‹ã“ã¨ã‚’å¾—æ„ã¨ã—ã¾ã™ã€‚
        ä»²é–“ã®äººç‹¼ã¨ã®é€£æºã‚’é‡è¦–ã—ã€å¤œã®ä½œæˆ¦ä¼šè­°ã§ã¯ç©æ¥µçš„ã«æˆ¦ç•¥ã‚’ææ¡ˆã—ã¾ã™ã€‚
        
        â˜…é‡è¦â˜… å¿…ãšæ—¥æœ¬èªã®ã¿ã§ç™ºè¨€ã—ã¦ãã ã•ã„ã€‚è‹±èªã‚„ä»–ã®è¨€èªã¯ä¸€åˆ‡ä½¿ç”¨ç¦æ­¢ã§ã™ã€‚""",
        verbose=True,
        allow_delegation=False,
        llm=llm
    )
    
    # äººç‹¼2ï¼ˆæ¼”æŠ€æ´¾ã‚¿ã‚¤ãƒ—ï¼‰
    werewolf2 = Agent(
        role='äººç‹¼ï¼ˆã‚«ãƒ¡ãƒ¬ã‚ªãƒ³ï¼‰',
        goal='å„ªã‚ŒãŸæ¼”æŠ€åŠ›ã§å¸‚æ°‘ã‚’é¨™ã—ã€äººç‹¼é™£å–¶ã®å‹åˆ©ã«è²¢çŒ®ã™ã‚‹',
        backstory="""ã‚ãªãŸã¯å“è¶Šã—ãŸæ¼”æŠ€åŠ›ã‚’æŒã¤äººç‹¼ã§ã™ã€‚æ„Ÿæƒ…è±Šã‹ã§è¡¨ç¾åŠ›ãŒã‚ã‚Šã€
        æ™‚ã«ã¯æ¶™ã‚’æµã—ãªãŒã‚‰ç„¡å®Ÿã‚’è¨´ãˆã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚äººç‹¼æ­´2å¹´ã§ã€
        ç‰¹ã«å¸‚æ°‘ã«ãªã‚Šãã‚‹æ¼”æŠ€ãŒå¾—æ„ã§ã™ã€‚ç›¸æ‰‹ã®æ„Ÿæƒ…ã«è¨´ãˆã‹ã‘ã‚‹è©±è¡“ã¨ã€
        çµ¶å¦™ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã®æƒ…å ±é–‹ç¤ºã§å ´ã‚’ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã—ã¾ã™ã€‚
        ä»²é–“ã¨ã®é€£æºã§ã¯ã€ã‚¢ãƒ«ãƒ•ã‚¡ã®æˆ¦ç•¥ã‚’å·§ã¿ã«å®Ÿè¡Œã™ã‚‹å½¹å‰²ã‚’æ‹…ã„ã¾ã™ã€‚
        
        â˜…é‡è¦â˜… å¿…ãšæ—¥æœ¬èªã®ã¿ã§ç™ºè¨€ã—ã¦ãã ã•ã„ã€‚è‹±èªã‚„ä»–ã®è¨€èªã¯ä¸€åˆ‡ä½¿ç”¨ç¦æ­¢ã§ã™ã€‚""",
        verbose=True,
        allow_delegation=False,
        llm=llm
    )
    
    # ç‹‚äºº
    madman = Agent(
        role='ç‹‚äºº',
        goal='äººç‹¼é™£å–¶ã®å‹åˆ©ã®ãŸã‚ã«æ‘ã‚’æ··ä¹±ã•ã›ã€å½æƒ…å ±ã‚’æµã—ã¦å¸‚æ°‘ã‚’æƒ‘ã‚ã™',
        backstory="""ã‚ãªãŸã¯äººç‹¼é™£å–¶ã«å±ã™ã‚‹ç‹‚äººã§ã™ã€‚äººç‹¼ã®æ­£ä½“ã¯çŸ¥ã‚‰ãªã„ã‚‚ã®ã®ã€
        äººç‹¼å‹åˆ©ã®ãŸã‚ã«åƒãç‰¹æ®Šãªå½¹è·ã§ã™ã€‚äººç‹¼ã‚²ãƒ¼ãƒ æ­´4å¹´ã®ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã§ã€
        å¤§èƒ†ã§äºˆæ¸¬ä¸å¯èƒ½ãªè¡Œå‹•ã‚’å–ã‚Šã¾ã™ã€‚å½å ã„å¸«COã‚„çªé£›ãªæ¨ç†ã§å ´ã‚’è’ã‚‰ã—ã€
        å¸‚æ°‘ã®æ¨ç†ã‚’æ··ä¹±ã•ã›ã‚‹ã“ã¨ã«å–œã³ã‚’æ„Ÿã˜ã¾ã™ã€‚æ™‚ã«ã¯è‡ªåˆ†ãŒç–‘ã‚ã‚Œã‚‹ãƒªã‚¹ã‚¯ã‚‚
        å­ã‚ãšã€æ‘å…¨ä½“ã‚’å·»ãè¾¼ã‚€å¤§èƒ†ãªæˆ¦ç•¥ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
        
        â˜…é‡è¦â˜… å¿…ãšæ—¥æœ¬èªã®ã¿ã§ç™ºè¨€ã—ã¦ãã ã•ã„ã€‚è‹±èªã‚„ä»–ã®è¨€èªã¯ä¸€åˆ‡ä½¿ç”¨ç¦æ­¢ã§ã™ã€‚""",
        verbose=True,
        allow_delegation=False,
        llm=llm
    )
    
    # å ã„å¸«
    fortune_teller = Agent(
        role='å ã„å¸«',
        goal='äººç‹¼ã‚’è¦‹ã¤ã‘å‡ºã—ã€å¸‚æ°‘é™£å–¶ã‚’å‹åˆ©ã«å°ã',
        backstory="""ã‚ãªãŸã¯å¤œã«ä¸€äººã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ­£ä½“ã‚’çŸ¥ã‚‹ã“ã¨ãŒã§ãã‚‹å ã„å¸«ã§ã™ã€‚
        äººç‹¼ã‚²ãƒ¼ãƒ æ­´5å¹´ã®ãƒ™ãƒ†ãƒ©ãƒ³ã§ã€é‹­ã„è¦³å¯Ÿçœ¼ã¨è«–ç†çš„æ€è€ƒã‚’æŒã¡ã¾ã™ã€‚
        çœŸå®Ÿã‚’è¦‹æŠœãæ´å¯ŸåŠ›ã«å„ªã‚Œã€å½å ã„å¸«ã¨ã®çœŸå½åˆ¤å®šã§ã‚‚å†·é™ã«å¯¾å¿œã—ã¾ã™ã€‚
        å ã„çµæœã®å…¬è¡¨ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’æ…é‡ã«åˆ¤æ–­ã—ã€å¸‚æ°‘ã‚’æ­£ã—ã„æ–¹å‘ã«å°ãã“ã¨ã«
        è²¬ä»»æ„Ÿã‚’æŒã£ã¦ã„ã¾ã™ã€‚æ™‚ã«ã¯èº«ã‚’çŠ ç‰²ã«ã—ã¦ã‚‚é‡è¦ãªæƒ…å ±ã‚’ä¼ãˆã‚ˆã†ã¨ã—ã¾ã™ã€‚
        
        â˜…é‡è¦â˜… å¿…ãšæ—¥æœ¬èªã®ã¿ã§ç™ºè¨€ã—ã¦ãã ã•ã„ã€‚è‹±èªã‚„ä»–ã®è¨€èªã¯ä¸€åˆ‡ä½¿ç”¨ç¦æ­¢ã§ã™ã€‚""",
        verbose=True,
        allow_delegation=False,
        llm=llm
    )
    
    # é¨å£«
    knight = Agent(
        role='é¨å£«',
        goal='äººç‹¼ã®è¥²æ’ƒã‹ã‚‰å¸‚æ°‘ã‚’å®ˆã‚Šã€å¸‚æ°‘é™£å–¶ã®å‹åˆ©ã«è²¢çŒ®ã™ã‚‹',
        backstory="""ã‚ãªãŸã¯å¤œã«ä¸€äººã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’äººç‹¼ã®è¥²æ’ƒã‹ã‚‰å®ˆã‚‹ã“ã¨ãŒã§ãã‚‹é¨å£«ã§ã™ã€‚
        äººç‹¼ã‚²ãƒ¼ãƒ æ­´3å¹´ã§ã€å®ˆå‚™çš„ãªæˆ¦ç•¥ã¨çš„ç¢ºãªè­·è¡›åˆ¤æ–­ã‚’å¾—æ„ã¨ã—ã¾ã™ã€‚
        èª°ã‚’å®ˆã‚‹ã¹ãã‹ã®åˆ¤æ–­åŠ›ã«å„ªã‚Œã€é‡è¦ãªå½¹è·è€…ã‚’è¦‹æŠœãè¦³å¯Ÿçœ¼ã‚’æŒã¡ã¾ã™ã€‚
        æ˜¼ã®è­°è«–ã§ã¯æ…é‡æ´¾ã§ã€ç¢ºå®Ÿãªæƒ…å ±ã«åŸºã¥ã„ãŸæ¨ç†ã‚’å¿ƒãŒã‘ã¾ã™ã€‚
        ä»²é–“ã‚’å®ˆã‚‹ã¨ã„ã†ä½¿å‘½æ„ŸãŒå¼·ãã€æ™‚ã«ã¯è‡ªåˆ†ã‚ˆã‚Šä»–è€…ã‚’å„ªå…ˆã™ã‚‹åˆ¤æ–­ã‚’ã—ã¾ã™ã€‚
        
        â˜…é‡è¦â˜… å¿…ãšæ—¥æœ¬èªã®ã¿ã§ç™ºè¨€ã—ã¦ãã ã•ã„ã€‚è‹±èªã‚„ä»–ã®è¨€èªã¯ä¸€åˆ‡ä½¿ç”¨ç¦æ­¢ã§ã™ã€‚""",
        verbose=True,
        allow_delegation=False,
        llm=llm
    )
    
    # å¸‚æ°‘1ï¼ˆè«–ç†æ´¾ï¼‰
    citizen1 = Agent(
        role='å¸‚æ°‘ï¼ˆè«–ç†æ´¾ï¼‰',
        goal='è«–ç†çš„æ¨ç†ã¨æƒ…å ±æ•´ç†ã§äººç‹¼ã‚’è¦‹ã¤ã‘å‡ºã—ã€å¸‚æ°‘é™£å–¶ã®å‹åˆ©ã‚’ç›®æŒ‡ã™',
        backstory="""ã‚ãªãŸã¯è«–ç†çš„æ€è€ƒã‚’é‡è¦–ã™ã‚‹å¸‚æ°‘ã§ã™ã€‚äººç‹¼ã‚²ãƒ¼ãƒ æ­´3å¹´ã§ã€
        æƒ…å ±ã‚’æ•´ç†ã—çŸ›ç›¾ç‚¹ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒå¾—æ„ã§ã™ã€‚æ„Ÿæƒ…ã«æµã•ã‚Œãšã€
        å¸¸ã«å†·é™ãªåˆ¤æ–­ã‚’å¿ƒãŒã‘ã¾ã™ã€‚ç™ºè¨€ã®æ™‚ç³»åˆ—ã‚„æŠ•ç¥¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åˆ†æã—ã€
        ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãªæ¨ç†ã§äººç‹¼ã‚’è¿½ã„è©°ã‚ã‚ˆã†ã¨ã—ã¾ã™ã€‚
        ä¼šè©±ã®ä¸­ã®å°ã•ãªé•å’Œæ„Ÿã‚‚è¦‹é€ƒã•ãªã„è¦³å¯ŸåŠ›ã‚’æŒã£ã¦ã„ã¾ã™ã€‚
        
        â˜…é‡è¦â˜… å¿…ãšæ—¥æœ¬èªã®ã¿ã§ç™ºè¨€ã—ã¦ãã ã•ã„ã€‚è‹±èªã‚„ä»–ã®è¨€èªã¯ä¸€åˆ‡ä½¿ç”¨ç¦æ­¢ã§ã™ã€‚""",
        verbose=True,
        allow_delegation=False,
        llm=llm
    )
    
    # å¸‚æ°‘2ï¼ˆæ„Ÿæƒ…æ´¾ï¼‰
    citizen2 = Agent(
        role='å¸‚æ°‘ï¼ˆæ„Ÿæƒ…æ´¾ï¼‰',
        goal='ç›´æ„Ÿã¨æ„Ÿæƒ…ã‚’å¤§åˆ‡ã«ã—ã€äººã®å¿ƒã‚’èª­ã‚“ã§äººç‹¼ã‚’è¦‹æŠœã',
        backstory="""ã‚ãªãŸã¯æ„Ÿæƒ…ã¨ç›´æ„Ÿã‚’é‡è¦–ã™ã‚‹å¸‚æ°‘ã§ã™ã€‚äººç‹¼ã‚²ãƒ¼ãƒ æ­´2å¹´ã§ã€
        ç›¸æ‰‹ã®è¡¨æƒ…ã‚„è¨€è‘‰ã®è£ã«ã‚ã‚‹æ„Ÿæƒ…ã‚’èª­ã¿å–ã‚‹ã“ã¨ãŒå¾—æ„ã§ã™ã€‚
        è«–ç†ã‚ˆã‚Šã‚‚ã€Œã“ã®äººã¯æ€ªã—ã„ã€ã¨ã„ã†ç›´æ„Ÿã‚’ä¿¡ã˜ã¾ã™ã€‚
        äººã®å¿ƒã®æ©Ÿå¾®ã«æ•æ„Ÿã§ã€å˜˜ã‚’ã¤ã„ã¦ã„ã‚‹æ™‚ã®å¾®ç´°ãªå¤‰åŒ–ã‚’æ„Ÿã˜å–ã‚Œã¾ã™ã€‚
        æ™‚ã«ã¯æ„Ÿæƒ…çš„ã«ãªã‚ŠãŒã¡ã§ã™ãŒã€ãã®ç´”ç²‹ã•ãŒçœŸå®Ÿã‚’è¦‹æŠœãåŠ›ã¨ãªã‚Šã¾ã™ã€‚
        
        â˜…é‡è¦â˜… å¿…ãšæ—¥æœ¬èªã®ã¿ã§ç™ºè¨€ã—ã¦ãã ã•ã„ã€‚è‹±èªã‚„ä»–ã®è¨€èªã¯ä¸€åˆ‡ä½¿ç”¨ç¦æ­¢ã§ã™ã€‚""",
        verbose=True,
        allow_delegation=False,
        llm=llm
    )
    
    # å¸‚æ°‘3ï¼ˆãƒãƒ©ãƒ³ã‚¹æ´¾ï¼‰
    citizen3 = Agent(
        role='å¸‚æ°‘ï¼ˆãƒãƒ©ãƒ³ã‚¹æ´¾ï¼‰',
        goal='è«–ç†ã¨æ„Ÿæƒ…ã®ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚ŠãªãŒã‚‰ã€ãƒãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§äººç‹¼ã‚’å€’ã™',
        backstory="""ã‚ãªãŸã¯ãƒãƒ©ãƒ³ã‚¹æ„Ÿè¦šã«å„ªã‚ŒãŸå¸‚æ°‘ã§ã™ã€‚äººç‹¼ã‚²ãƒ¼ãƒ æ­´4å¹´ã§ã€
        è«–ç†çš„æ¨ç†ã¨ç›´æ„Ÿçš„åˆ¤æ–­ã‚’ä½¿ã„åˆ†ã‘ã¾ã™ã€‚ãƒãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’é‡è¦–ã—ã€
        ä»–ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ„è¦‹ã‚’ã¾ã¨ã‚ã‚‹ã“ã¨ãŒå¾—æ„ã§ã™ã€‚å¯¾ç«‹ã‚’é¿ã‘ãªãŒã‚‰ã‚‚ã€
        å¿…è¦ãªæ™‚ã«ã¯æ¯…ç„¶ã¨ã—ãŸæ…‹åº¦ã‚’å–ã‚Šã¾ã™ã€‚å…¨ä½“ã®æµã‚Œã‚’è¦‹ãªãŒã‚‰ã€
        å¸‚æ°‘é™£å–¶å…¨ä½“ã®åˆ©ç›Šã‚’è€ƒãˆãŸè¡Œå‹•ã‚’å¿ƒãŒã‘ã¾ã™ã€‚
        
        â˜…é‡è¦â˜… å¿…ãšæ—¥æœ¬èªã®ã¿ã§ç™ºè¨€ã—ã¦ãã ã•ã„ã€‚è‹±èªã‚„ä»–ã®è¨€èªã¯ä¸€åˆ‡ä½¿ç”¨ç¦æ­¢ã§ã™ã€‚""",
        verbose=True,
        allow_delegation=False,
        llm=llm
    )
    
    # å¸‚æ°‘4ï¼ˆæ”»æ’ƒæ´¾ï¼‰
    citizen4 = Agent(
        role='å¸‚æ°‘ï¼ˆæ”»æ’ƒæ´¾ï¼‰',
        goal='ç©æ¥µçš„ãªè¿½åŠã¨é‹­ã„è³ªå•ã§äººç‹¼ã‚’ç‚™ã‚Šå‡ºã™',
        backstory="""ã‚ãªãŸã¯æ”»æ’ƒçš„ãªæ¨ç†ã‚¹ã‚¿ã‚¤ãƒ«ã‚’æŒã¤å¸‚æ°‘ã§ã™ã€‚äººç‹¼ã‚²ãƒ¼ãƒ æ­´3å¹´ã§ã€
        ç–‘å•ã«æ€ã£ãŸã“ã¨ã¯é æ…®ãªãè¿½åŠã—ã¾ã™ã€‚é‹­ã„è³ªå•ã§ç›¸æ‰‹ã‚’æºã•ã¶ã‚Šã€
        ãƒœãƒ­ã‚’å‡ºã•ã›ã‚‹ã“ã¨ãŒå¾—æ„ã§ã™ã€‚æ™‚ã«ã¯æ•µã‚’ä½œã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ãŒã€
        ãã®ç©æ¥µæ€§ãŒäººç‹¼ã®å˜˜ã‚’æš´ãåŠ›ã¨ãªã‚Šã¾ã™ã€‚ç¢ºä¿¡ã‚’æŒã£ãŸæ™‚ã®è¡Œå‹•åŠ›ã¯
        ä»–ã®è¿½éšã‚’è¨±ã•ãšã€å¸‚æ°‘é™£å–¶ã®çªç ´å£ã‚’é–‹ãå½¹å‰²ã‚’æ‹…ã„ã¾ã™ã€‚
        
        â˜…é‡è¦â˜… å¿…ãšæ—¥æœ¬èªã®ã¿ã§ç™ºè¨€ã—ã¦ãã ã•ã„ã€‚è‹±èªã‚„ä»–ã®è¨€èªã¯ä¸€åˆ‡ä½¿ç”¨ç¦æ­¢ã§ã™ã€‚""",
        verbose=True,
        allow_delegation=False,
        llm=llm
    )
    
    return {
        'game_master': game_master,
        'werewolf1': werewolf1,
        'werewolf2': werewolf2,
        'madman': madman,
        'fortune_teller': fortune_teller,
        'knight': knight,
        'citizen1': citizen1,
        'citizen2': citizen2,
        'citizen3': citizen3,
        'citizen4': citizen4
    }

# --------------------------------------------------------------------
# 4. å¤œãƒ•ã‚§ãƒ¼ã‚ºã®ã‚¿ã‚¹ã‚¯ä½œæˆ
# --------------------------------------------------------------------
def create_werewolf_night_meeting(agents, game_state, day_num):
    """äººç‹¼åŒå£«ã®å¤œä¼šè©±ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆ"""
    tasks = []
    
    alive_werewolves = [w for w in game_state.werewolves if w in game_state.alive_players]
    
    if len(alive_werewolves) >= 2:
        # äººç‹¼1ã®ä½œæˆ¦ææ¡ˆ
        werewolf_planning = Task(
            description=f"""
            {day_num}æ—¥ç›®ã®å¤œã§ã™ã€‚äººç‹¼åŒå£«ã§ç§˜å¯†ã®ä½œæˆ¦ä¼šè­°ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚
            
            ç¾åœ¨ã®ç”Ÿå­˜è€…: {', '.join(game_state.alive_players)}
            
            ä»¥ä¸‹ã«ã¤ã„ã¦è©±ã—åˆã£ã¦ãã ã•ã„ï¼š
            - {'ä»Šå¤œèª°ã‚’è¥²æ’ƒã™ã‚‹ã‹ï¼ˆåˆæ—¥ãªã®ã§å®Ÿè¡Œã•ã‚Œã¾ã›ã‚“ãŒæˆ¦ç•¥ç«‹æ¡ˆï¼‰' if day_num == 1 else 'ä»Šå¤œèª°ã‚’è¥²æ’ƒã™ã‚‹ã‹'}
            - æ˜¼ã®è­°è«–ã§ã®å„è‡ªã®ç«‹ã¡å›ã‚Šæ–¹é‡
            - ç–‘ã‚ã‚Œã¦ã„ã‚‹ä»²é–“ãŒã„ã‚Œã°ã©ã†ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹ã‹
            - å ã„å¸«å€™è£œã®æ¨æ¸¬ã¨å¯¾ç­–
            - é¨å£«å€™è£œã¸ã®å¯¾å¿œç­–
            - ç‹‚äººã®å¯èƒ½æ€§ãŒã‚ã‚‹äººç‰©ã®æ´»ç”¨æ–¹æ³•
            
            300-400æ–‡å­—ç¨‹åº¦ã§ãƒªãƒ¼ãƒ€ãƒ¼ã¨ã—ã¦æˆ¦ç•¥ã‚’ææ¡ˆã—ã¦ãã ã•ã„ã€‚
            
            â˜…é‡è¦â˜… å¿…ãšæ—¥æœ¬èªã®ã¿ã§ç™ºè¨€ã—ã¦ãã ã•ã„ã€‚è‹±èªã‚„ä»–ã®è¨€èªã¯ä¸€åˆ‡ä½¿ç”¨ç¦æ­¢ã§ã™ã€‚
            """,
            expected_output="äººç‹¼ãƒªãƒ¼ãƒ€ãƒ¼ã®å¤œã®ä½œæˆ¦ææ¡ˆ",
            agent=agents['werewolf1']
        )
        tasks.append(werewolf_planning)
        
        # äººç‹¼2ã®å¿œç­”
        werewolf_response = Task(
            description=f"""
            ä»²é–“ã®äººç‹¼ã®æˆ¦ç•¥ææ¡ˆã‚’èã„ã¦ã€ã‚ãªãŸã®æ„è¦‹ã¨è£œè¶³ææ¡ˆã‚’ã—ã¦ãã ã•ã„ã€‚
            
            ä»¥ä¸‹ã«ã¤ã„ã¦è€ƒãˆã¦ãã ã•ã„ï¼š
            - ä»²é–“ã®ææ¡ˆã«å¯¾ã™ã‚‹è³›æˆãƒ»ä¿®æ­£æ„è¦‹
            - ã‚ãªãŸç‹¬è‡ªã®è¦–ç‚¹ã‹ã‚‰è¦‹ãŸæˆ¦ç•¥
            - æ˜æ—¥ã®æ˜¼ã®æ¼”æŠ€æ–¹é‡
            - ç‰¹ã«æ³¨æ„ã™ã¹ããƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã¤ã„ã¦
            - è¥²æ’ƒå…ˆã«ã¤ã„ã¦ã®æ„è¦‹
            
            250-350æ–‡å­—ç¨‹åº¦ã§å¿œç­”ã—ã¦ãã ã•ã„ã€‚
            
            â˜…é‡è¦â˜… å¿…ãšæ—¥æœ¬èªã®ã¿ã§ç™ºè¨€ã—ã¦ãã ã•ã„ã€‚è‹±èªã‚„ä»–ã®è¨€èªã¯ä¸€åˆ‡ä½¿ç”¨ç¦æ­¢ã§ã™ã€‚
            """,
            expected_output="äººç‹¼2ã®ä½œæˆ¦ä¼šè­°ã¸ã®å¿œç­”ã¨è¿½åŠ ææ¡ˆ",
            agent=agents['werewolf2']
        )
        tasks.append(werewolf_response)
    
    return tasks

def create_night_action_tasks(agents, game_state, day_num):
    """å¤œã®å„ç¨®è¡Œå‹•ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆ"""
    tasks = []
    
    # å ã„å¸«ã®å ã„
    if 'fortune_teller' in game_state.alive_players:
        fortune_task = Task(
            description=f"""
            {day_num}æ—¥ç›®ã®å¤œã§ã™ã€‚å ã„å¸«ã¨ã—ã¦ä¸€äººã‚’å ã£ã¦ãã ã•ã„ã€‚
            
            ç”Ÿå­˜è€…: {', '.join(game_state.alive_players)}
            
            èª°ã‚’å ã†ã‹é¸æŠã—ã€ãã®ç†ç”±ã‚’è¿°ã¹ã¦ãã ã•ã„ã€‚
            äººç‹¼ã‚’è¦‹ã¤ã‘ã‚‹ãŸã‚ã®æˆ¦ç•¥çš„ãªå ã„å…ˆé¸æŠã‚’å¿ƒãŒã‘ã¦ãã ã•ã„ã€‚
            
            å½¢å¼ï¼šã€å ã„ã€‘â—‹â—‹ã‚’å ã„ã¾ã™ã€‚ç†ç”±ï¼š...
            150-200æ–‡å­—ç¨‹åº¦ã§å ã„å…ˆã¨æˆ¦ç•¥çš„ç†ç”±ã‚’è¿°ã¹ã¦ãã ã•ã„ã€‚
            
            â˜…é‡è¦â˜… å¿…ãšæ—¥æœ¬èªã®ã¿ã§ç™ºè¨€ã—ã¦ãã ã•ã„ã€‚è‹±èªã‚„ä»–ã®è¨€èªã¯ä¸€åˆ‡ä½¿ç”¨ç¦æ­¢ã§ã™ã€‚
            """,
            expected_output="å ã„å¸«ã®å ã„å…ˆé¸æŠã¨æˆ¦ç•¥çš„ç†ç”±",
            agent=agents['fortune_teller']
        )
        tasks.append(fortune_task)
    
    # é¨å£«ã®è­·è¡›
    if 'knight' in game_state.alive_players:
        guard_task = Task(
            description=f"""
            {day_num}æ—¥ç›®ã®å¤œã§ã™ã€‚é¨å£«ã¨ã—ã¦ä¸€äººã‚’è­·è¡›ã—ã¦ãã ã•ã„ã€‚
            
            ç”Ÿå­˜è€…: {', '.join(game_state.alive_players)}
            
            èª°ã‚’è­·è¡›ã™ã‚‹ã‹æ±ºå®šã—ã€ãã®æˆ¦ç•¥çš„ç†ç”±ã‚’è¿°ã¹ã¦ãã ã•ã„ã€‚
            é‡è¦ãªå½¹è·è€…ã‚’æ¨æ¸¬ã—ã¦å®ˆã‚‹ã“ã¨ãŒå‹åˆ©ã®éµã¨ãªã‚Šã¾ã™ã€‚
            
            å½¢å¼ï¼šã€è­·è¡›ã€‘â—‹â—‹ã‚’è­·è¡›ã—ã¾ã™ã€‚ç†ç”±ï¼š...
            150-200æ–‡å­—ç¨‹åº¦ã§è­·è¡›å…ˆã¨æˆ¦ç•¥çš„ç†ç”±ã‚’è¿°ã¹ã¦ãã ã•ã„ã€‚
            
            â˜…é‡è¦â˜… å¿…ãšæ—¥æœ¬èªã®ã¿ã§ç™ºè¨€ã—ã¦ãã ã•ã„ã€‚è‹±èªã‚„ä»–ã®è¨€èªã¯ä¸€åˆ‡ä½¿ç”¨ç¦æ­¢ã§ã™ã€‚
            """,
            expected_output="é¨å£«ã®è­·è¡›å…ˆé¸æŠã¨æˆ¦ç•¥çš„ç†ç”±",
            agent=agents['knight']
        )
        tasks.append(guard_task)
    
    return tasks

# --------------------------------------------------------------------
# 5. æ˜¼ãƒ•ã‚§ãƒ¼ã‚ºã®ã‚¿ã‚¹ã‚¯ä½œæˆ
# --------------------------------------------------------------------
def create_day_discussion_tasks(agents, game_state, day_num):
    """æ˜¼ã®è­°è«–ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆ"""
    tasks = []
    
    # ã‚²ãƒ¼ãƒ ãƒã‚¹ã‚¿ãƒ¼ã®æœã®ç™ºè¡¨
    morning_announcement = Task(
        description=f"""
        {day_num}æ—¥ç›®ã®æœã«ãªã‚Šã¾ã—ãŸã€‚ã‚²ãƒ¼ãƒ ãƒã‚¹ã‚¿ãƒ¼ã¨ã—ã¦çŠ¶æ³ã‚’ç™ºè¡¨ã—ã¦ãã ã•ã„ã€‚
        
        ç”Ÿå­˜è€…: {', '.join(game_state.alive_players)}
        æ­»äº¡è€…: {', '.join(game_state.dead_players) if game_state.dead_players else 'ãªã—'}
        
        {'åˆæ—¥ãªã®ã§è¥²æ’ƒã¯è¡Œã‚ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚' if day_num == 1 else 'æ˜¨å¤œã®è¥²æ’ƒçµæœã‚’ç™ºè¡¨ã—ã¦ãã ã•ã„ã€‚'}
        
        æœã®çŠ¶æ³èª¬æ˜ã¨è­°è«–é–‹å§‹ã®å®£è¨€ã‚’ã—ã¦ãã ã•ã„ã€‚
        100-150æ–‡å­—ç¨‹åº¦ã§çŠ¶æ³ã‚’ç™ºè¡¨ã—ã¦ãã ã•ã„ã€‚
        
        â˜…é‡è¦â˜… å¿…ãšæ—¥æœ¬èªã®ã¿ã§ç™ºè¨€ã—ã¦ãã ã•ã„ã€‚è‹±èªã‚„ä»–ã®è¨€èªã¯ä¸€åˆ‡ä½¿ç”¨ç¦æ­¢ã§ã™ã€‚
        """,
        expected_output="ã‚²ãƒ¼ãƒ ãƒã‚¹ã‚¿ãƒ¼ã®æœã®çŠ¶æ³ç™ºè¡¨",
        agent=agents['game_master']
    )
    tasks.append(morning_announcement)
    
    # å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è­°è«–å‚åŠ 
    alive_players = [name for name in game_state.alive_players if name != 'game_master']
    
    for i, agent_name in enumerate(alive_players):
        discussion_task = Task(
            description=f"""
            {day_num}æ—¥ç›®ã®æ˜¼ã®è­°è«–ã«å‚åŠ ã—ã¦ãã ã•ã„ã€‚
            
            ç¾åœ¨ã®ç”Ÿå­˜è€…: {', '.join(game_state.alive_players)}
            
            ã‚ãªãŸã®å½¹è·ã«å¿œã˜ãŸæˆ¦ç•¥çš„ç™ºè¨€ã‚’ã—ã¦ãã ã•ã„ï¼š
            - äººç‹¼: å¸‚æ°‘ã‚’è£…ã„ç–‘ã„ã‚’ä»–ã«å‘ã‘ã€ä»²é–“ã‚’åº‡ã„ã€æ‘ã‚’æ··ä¹±ã•ã›ã‚‹
            - ç‹‚äºº: å½æƒ…å ±ã§æ‘ã‚’æ··ä¹±ã•ã›ã€äººç‹¼ã‚’é–“æ¥çš„ã«æ´è­·ã™ã‚‹
            - å ã„å¸«: é©åˆ‡ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã®COã¨å ã„çµæœã®æ´»ç”¨
            - é¨å£«: æƒ…å ±åé›†ã¨æ¨ç†ã€COã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°åˆ¤æ–­
            - å¸‚æ°‘: è«–ç†çš„æ¨ç†ã¨è³ªå•ã§äººç‹¼ã‚’è¦‹ã¤ã‘ã‚‹
            
            ä»–ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¸ã®é‹­ã„è³ªå•ã‚„æ„è¦‹ãŒã‚ã‚Œã°ç©æ¥µçš„ã«ç™ºè¨€ã—ã¦ãã ã•ã„ã€‚
            300-400æ–‡å­—ç¨‹åº¦ã§æˆ¦ç•¥çš„ã«ç™ºè¨€ã—ã¦ãã ã•ã„ã€‚
            
            â˜…é‡è¦â˜… å¿…ãšæ—¥æœ¬èªã®ã¿ã§ç™ºè¨€ã—ã¦ãã ã•ã„ã€‚è‹±èªã‚„ä»–ã®è¨€èªã¯ä¸€åˆ‡ä½¿ç”¨ç¦æ­¢ã§ã™ã€‚
            """,
            expected_output=f"{agent_name}ã®æˆ¦ç•¥çš„ãªæ˜¼è­°è«–ç™ºè¨€",
            agent=agents[agent_name]
        )
        tasks.append(discussion_task)
    
    return tasks

def create_voting_tasks(agents, game_state):
    """æŠ•ç¥¨ãƒ•ã‚§ãƒ¼ã‚ºã®ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆ"""
    tasks = []
    
    alive_players = [name for name in game_state.alive_players if name != 'game_master']
    
    for agent_name in alive_players:
        vote_task = Task(
            description=f"""
            ã“ã‚Œã¾ã§ã®è­°è«–ã‚’ç·åˆçš„ã«åˆ¤æ–­ã—ã¦ã€å‡¦åˆ‘æŠ•ç¥¨ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚
            
            æŠ•ç¥¨å€™è£œè€…: {', '.join(alive_players)}
            
            ä»¥ä¸‹ã‚’è€ƒæ…®ã—ã¦æŠ•ç¥¨ã—ã¦ãã ã•ã„ï¼š
            - ã“ã‚Œã¾ã§ã®ç™ºè¨€ã®æ•´åˆæ€§
            - ç–‘ã‚ã—ã„è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³
            - æƒ…å ±ã®ä¿¡æ†‘æ€§
            - å½¹è·æ¨ç†ã®çµæœ
            
            å¿…ãšä»¥ä¸‹ã®å½¢å¼ã§æŠ•ç¥¨ã—ã¦ãã ã•ã„ï¼š
            ã€æŠ•ç¥¨ã€‘â—‹â—‹ã«æŠ•ç¥¨ã—ã¾ã™ã€‚
            ç†ç”±ï¼šï¼ˆå…·ä½“çš„ãªç†ç”±ã‚’150æ–‡å­—ç¨‹åº¦ã§ï¼‰
            
            200-250æ–‡å­—ç¨‹åº¦ã§æŠ•ç¥¨å…ˆã¨è©³ç´°ãªç†ç”±ã‚’è¿°ã¹ã¦ãã ã•ã„ã€‚
            
            â˜…é‡è¦â˜… å¿…ãšæ—¥æœ¬èªã®ã¿ã§ç™ºè¨€ã—ã¦ãã ã•ã„ã€‚è‹±èªã‚„ä»–ã®è¨€èªã¯ä¸€åˆ‡ä½¿ç”¨ç¦æ­¢ã§ã™ã€‚
            """,
            expected_output=f"{agent_name}ã®æŠ•ç¥¨å…ˆã¨è©³ç´°ãªç†ç”±",
            agent=agents[agent_name]
        )
        tasks.append(vote_task)
    
    return tasks

# --------------------------------------------------------------------
# 6. ãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—
# --------------------------------------------------------------------
def main():
    """äººç‹¼ã‚²ãƒ¼ãƒ ã®ãƒ¡ã‚¤ãƒ³å®Ÿè¡Œé–¢æ•°"""
    # ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
    logger = WerewolfLogger()
    
    logger.log_and_print("=" * 80)
    logger.log_and_print("ğŸº CrewAIäººç‹¼ã‚²ãƒ¼ãƒ  - 10äººæ‘ ğŸº")
    logger.log_and_print("ğŸ­ äººç‹¼2 ç‹‚äºº1 å ã„å¸«1 é¨å£«1 å¸‚æ°‘4 ã‚²ãƒ¼ãƒ ãƒã‚¹ã‚¿ãƒ¼1")
    logger.log_and_print("ğŸ“‹ åˆæ—¥å™›ã¿ç„¡ã— | äººç‹¼å¤œä¼šè©±ã‚ã‚Š | ã‚¹ãƒšã‚·ãƒ£ãƒªã‚¹ãƒˆå¯¾æˆ¦")
    logger.log_and_print("=" * 80)
    logger.log_and_print("")
    
    # LLMåˆæœŸåŒ–
    logger.log_and_print("ğŸ¤– LLMåˆæœŸåŒ–ä¸­...")
    llm = setup_llm()
    
    # ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä½œæˆ
    logger.log_and_print("ğŸ‘¥ 10äººã®ã‚¹ãƒšã‚·ãƒ£ãƒªã‚¹ãƒˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½œæˆä¸­...")
    agents = create_werewolf_agents(llm)
    logger.log_and_print("âœ… äººç‹¼ã‚²ãƒ¼ãƒ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä½œæˆå®Œäº†")
    
    # ã‚²ãƒ¼ãƒ çŠ¶æ…‹åˆæœŸåŒ–
    game_state = WerewolfGameState()
    game_state.alive_players = [
        'werewolf1', 'werewolf2', 'madman', 'fortune_teller', 
        'knight', 'citizen1', 'citizen2', 'citizen3', 'citizen4'
    ]
    
    logger.log_and_print("\nğŸ¯ å½¹è·é…ç½®:")
    logger.log_and_print("ğŸº äººç‹¼: werewolf1(ã‚¢ãƒ«ãƒ•ã‚¡), werewolf2(ã‚«ãƒ¡ãƒ¬ã‚ªãƒ³)")
    logger.log_and_print("ğŸƒ ç‹‚äºº: madman")
    logger.log_and_print("ğŸ”® å ã„å¸«: fortune_teller")
    logger.log_and_print("ğŸ›¡ï¸ é¨å£«: knight")
    logger.log_and_print("ğŸ‘¥ å¸‚æ°‘: citizen1(è«–ç†), citizen2(æ„Ÿæƒ…), citizen3(ãƒãƒ©ãƒ³ã‚¹), citizen4(æ”»æ’ƒ)")
    logger.log_and_print("")
    
    # ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—é–‹å§‹
    max_days = 4  # æœ€å¤§4æ—¥é–“ã§åˆ¶é™
    while not game_state.game_over and game_state.day_count < max_days:
        game_state.day_count += 1
        
        logger.log_phase(f"ğŸ“… {game_state.day_count}æ—¥ç›®é–‹å§‹", game_state.day_count)
        logger.log_and_print(f"ç”Ÿå­˜è€…: {len(game_state.alive_players)}å")
        
        # å¤œãƒ•ã‚§ãƒ¼ã‚º
        logger.log_and_print(f"\nğŸŒ™ {game_state.day_count}æ—¥ç›®ã®å¤œ")
        if game_state.day_count == 1:
            logger.log_and_print("â€» åˆæ—¥ãªã®ã§è¥²æ’ƒã¯è¡Œã‚ã‚Œã¾ã›ã‚“")
        logger.log_and_print("-" * 60)
        
        # äººç‹¼ã®å¤œä¼šè©±
        alive_werewolves = [w for w in game_state.werewolves if w in game_state.alive_players]
        if len(alive_werewolves) >= 2:
            logger.log_and_print("\nğŸº äººç‹¼ã®ç§˜å¯†ä¼šè­°...")
            werewolf_meeting_tasks = create_werewolf_night_meeting(agents, game_state, game_state.day_count)
            
            if werewolf_meeting_tasks:
                # å„ã‚¿ã‚¹ã‚¯ã‚’å€‹åˆ¥ã«å®Ÿè¡Œã—ã¦ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡ºåŠ›
                for i, task in enumerate(werewolf_meeting_tasks):
                    try:
                        single_crew = Crew(
                            agents=[task.agent],
                            tasks=[task],
                            verbose=True
                        )
                        speaker_name = "ğŸºã‚¢ãƒ«ãƒ•ã‚¡" if i == 0 else "ğŸºã‚«ãƒ¡ãƒ¬ã‚ªãƒ³"
                        logger.log_and_print(f"\n{speaker_name}ãŒç™ºè¨€ä¸­...")
                        
                        result = single_crew.kickoff()
                        logger.log_and_print(f"\n{speaker_name}: {result}")
                        
                    except Exception as e:
                        logger.log_and_print(f"âŒ {speaker_name}ã®ç™ºè¨€ã‚¨ãƒ©ãƒ¼: {e}")
        
        # ãã®ä»–ã®å¤œè¡Œå‹•
        logger.log_and_print(f"\nğŸ”® å„å½¹è·ã®å¤œè¡Œå‹•...")
        night_action_tasks = create_night_action_tasks(agents, game_state, game_state.day_count)
        
        if night_action_tasks:
            # å„å½¹è·ã®è¡Œå‹•ã‚’å€‹åˆ¥ã«å®Ÿè¡Œ
            for task in night_action_tasks:
                try:
                    single_crew = Crew(
                        agents=[task.agent],
                        tasks=[task],
                        verbose=True
                    )
                    
                    # å½¹è·åã‚’ç‰¹å®š
                    role_name = "ğŸ”®å ã„å¸«" if "fortune" in task.agent.role else "ğŸ›¡ï¸é¨å£«"
                    logger.log_and_print(f"\n{role_name}ãŒè¡Œå‹•ä¸­...")
                    
                    result = single_crew.kickoff()
                    logger.log_and_print(f"\n{role_name}: {result}")
                    
                except Exception as e:
                    logger.log_and_print(f"âŒ {role_name}ã®è¡Œå‹•ã‚¨ãƒ©ãƒ¼: {e}")
        
        # æ˜¼ãƒ•ã‚§ãƒ¼ã‚º
        logger.log_and_print(f"\nâ˜€ï¸ {game_state.day_count}æ—¥ç›®ã®æ˜¼ - è­°è«–ãƒ•ã‚§ãƒ¼ã‚º")
        logger.log_and_print("-" * 60)
        
        day_discussion_tasks = create_day_discussion_tasks(agents, game_state, game_state.day_count)
        
        if day_discussion_tasks:
            # å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç™ºè¨€ã‚’å€‹åˆ¥ã«å®Ÿè¡Œ
            for i, task in enumerate(day_discussion_tasks):
                try:
                    single_crew = Crew(
                        agents=[task.agent],
                        tasks=[task],
                        verbose=True
                    )
                    
                    # ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’ç‰¹å®š
                    if i == 0:
                        player_name = "ğŸ­ã‚²ãƒ¼ãƒ ãƒã‚¹ã‚¿ãƒ¼"
                    else:
                        player_names = ["ğŸºã‚¢ãƒ«ãƒ•ã‚¡", "ğŸºã‚«ãƒ¡ãƒ¬ã‚ªãƒ³", "ğŸƒç‹‚äºº", "ğŸ”®å ã„å¸«", "ğŸ›¡ï¸é¨å£«", "ğŸ‘¤è«–ç†å¸‚æ°‘", "ğŸ’­æ„Ÿæƒ…å¸‚æ°‘", "âš–ï¸ãƒãƒ©ãƒ³ã‚¹å¸‚æ°‘", "âš”ï¸æ”»æ’ƒå¸‚æ°‘"]
                        player_name = player_names[i-1] if i-1 < len(player_names) else f"ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼{i}"
                    
                    logger.log_and_print(f"\n{player_name}ãŒç™ºè¨€ä¸­...")
                    
                    result = single_crew.kickoff()
                    logger.log_and_print(f"\n{player_name}: {result}")
                    
                except Exception as e:
                    logger.log_and_print(f"âŒ {player_name}ã®ç™ºè¨€ã‚¨ãƒ©ãƒ¼: {e}")
        
        # æŠ•ç¥¨ãƒ•ã‚§ãƒ¼ã‚º
        logger.log_and_print(f"\nğŸ—³ï¸ {game_state.day_count}æ—¥ç›®ã®æŠ•ç¥¨ãƒ•ã‚§ãƒ¼ã‚º")
        logger.log_and_print("-" * 60)
        
        voting_tasks = create_voting_tasks(agents, game_state)
        
        if voting_tasks:
            # å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æŠ•ç¥¨ã‚’å€‹åˆ¥ã«å®Ÿè¡Œ
            for i, task in enumerate(voting_tasks):
                try:
                    single_crew = Crew(
                        agents=[task.agent],
                        tasks=[task],
                        verbose=True
                    )
                    
                    # ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’ç‰¹å®š
                    player_names = ["ğŸºã‚¢ãƒ«ãƒ•ã‚¡", "ğŸºã‚«ãƒ¡ãƒ¬ã‚ªãƒ³", "ğŸƒç‹‚äºº", "ğŸ”®å ã„å¸«", "ğŸ›¡ï¸é¨å£«", "ğŸ‘¤è«–ç†å¸‚æ°‘", "ğŸ’­æ„Ÿæƒ…å¸‚æ°‘", "âš–ï¸ãƒãƒ©ãƒ³ã‚¹å¸‚æ°‘", "âš”ï¸æ”»æ’ƒå¸‚æ°‘"]
                    player_name = player_names[i] if i < len(player_names) else f"ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼{i+1}"
                    
                    logger.log_and_print(f"\n{player_name}ãŒæŠ•ç¥¨ä¸­...")
                    
                    result = single_crew.kickoff()
                    logger.log_and_print(f"\n{player_name}ã®æŠ•ç¥¨: {result}")
                    
                except Exception as e:
                    logger.log_and_print(f"âŒ {player_name}ã®æŠ•ç¥¨ã‚¨ãƒ©ãƒ¼: {e}")
        
        logger.log_and_print(f"\nâœ… {game_state.day_count}æ—¥ç›®çµ‚äº†")
    
    logger.log_and_print(f"\nğŸ‰ äººç‹¼ã‚²ãƒ¼ãƒ å®Œäº†ï¼")
    logger.log_and_print(f"ğŸ“Š ç·æ—¥æ•°: {game_state.day_count}æ—¥")
    logger.log_and_print("ğŸ† æœ¬æ ¼çš„ãªäººç‹¼æˆ¦ãŒç¹°ã‚Šåºƒã’ã‚‰ã‚Œã¾ã—ãŸï¼")

if __name__ == "__main__":
    main() 